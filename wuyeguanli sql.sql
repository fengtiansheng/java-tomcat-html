-- 1. 创建数据库（若不存在），指定字符集和排序规则（避免中文乱码）
CREATE DATABASE IF NOT EXISTS property_system
DEFAULT CHARACTER SET utf8mb4
DEFAULT COLLATE utf8mb4_unicode_ci; 

-- 2. 切换到目标数据库
USE property_system;

-- 3. 业主信息表（修正表名小写，补充引擎和字符集，与后端代码一致）
CREATE TABLE IF NOT EXISTS OWNER (
      owner_id VARCHAR(20) PRIMARY KEY COMMENT '业主编号（唯一标识）',
      NAME VARCHAR(50) NOT NULL COMMENT '业主姓名',
      phone VARCHAR(20) NOT NULL COMMENT '联系电话',
      address VARCHAR(200) NOT NULL COMMENT '业主地址'
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT '业主信息表';

-- 4. 管理人员信息表（修正字段小写，补充引擎和字符集，密码字段保留50位适配明文/MD5）
CREATE TABLE IF NOT EXISTS manager (
      manager_id VARCHAR(20) PRIMARY KEY COMMENT '管理人员账号',
      PASSWORD VARCHAR(50) NOT NULL COMMENT '登录密码'
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT '管理人员信息表';

-- 5. 通知公告信息表（修正字段小写，补充引擎和字符集，自增ID适配后端查询）
CREATE TABLE IF NOT EXISTS notice (
      notice_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '通知公告ID（自增）',
      title VARCHAR(100) NOT NULL COMMENT '公告标题',
      cover VARCHAR(200) NULL COMMENT '公告封面（可存图片路径）',
      DESCRIPTION VARCHAR(200) NULL COMMENT '公告描述',
      content TEXT NOT NULL COMMENT '公告正文'
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT '通知公告信息表';

-- 完整的 charge_info 表创建 SQL（含缴费状态字段）
CREATE TABLE IF NOT EXISTS `charge_info` (
    `charge_id` INT AUTO_INCREMENT PRIMARY KEY COMMENT '收费记录ID（自增主键）',
    `owner_id` VARCHAR(20) NOT NULL COMMENT '业主编号（关联 owner 表）',
    `charge_item` VARCHAR(50) NOT NULL COMMENT '收费项目（如物业费、水电费）',
    `charge_amount` DECIMAL(10,2) NOT NULL COMMENT '收费金额（保留两位小数）',
    `charge_detail` VARCHAR(200) NULL COMMENT '收费明细（可选，如「2025年12月物业费」）',
    `manager_id` VARCHAR(20) NOT NULL COMMENT '收费人员（关联 manager 表）',
    `charge_time` DATETIME NOT NULL COMMENT '收费时间（记录创建/收费操作时间）',
    `status` ENUM('待缴','已缴') NOT NULL DEFAULT '待缴' COMMENT '缴费状态（待缴/已缴）',
    -- 外键约束（与你的原有代码一致，确保数据完整性）
    FOREIGN KEY (`manager_id`) REFERENCES `manager`(`manager_id`) ON DELETE CASCADE,
    FOREIGN KEY (`owner_id`) REFERENCES `owner`(`owner_id`) ON DELETE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT='收费信息表（存储业主缴费/待缴记录）';

-- 7. 管理人员公告操作日志表（新增表，后端可后续扩展日志功能）
CREATE TABLE IF NOT EXISTS manager_notice_operate (
      operate_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '操作日志ID',
      manager_id VARCHAR(20) NOT NULL COMMENT '关联管理人员账号',
      notice_id INT NOT NULL COMMENT '关联通知公告ID',
      operate_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
      FOREIGN KEY (manager_id) REFERENCES manager(manager_id) ON DELETE CASCADE,
      FOREIGN KEY (notice_id) REFERENCES notice(notice_id) ON DELETE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT '管理人员操作通知公告的日志表';

-- 8. 维修人员信息表（新增表，关联维修设备表，补充引擎和字符集）
CREATE TABLE IF NOT EXISTS repair_staff (
      staff_id VARCHAR(20) PRIMARY KEY COMMENT '工号（主键）',
      NAME VARCHAR(50) NOT NULL COMMENT '维修人员姓名',
      contact VARCHAR(20) NOT NULL COMMENT '联系方式'
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT '维修人员信息表';

-- 9. 维修设备信息表（修正注释，补充新增字段，外键约束适配维修人员表）
CREATE TABLE IF NOT EXISTS repair_equipment (
      equip_id VARCHAR(20) PRIMARY KEY COMMENT '设备编号（主键）',
      equip_name VARCHAR(50) NOT NULL COMMENT '设备名称',
      repair_content TEXT NOT NULL COMMENT '维修内容',
      repair_status ENUM('未维修','维修中','已维修') NOT NULL DEFAULT '未维修' COMMENT '维修状态',
      repair_time DATETIME NOT NULL COMMENT '维修时间',
      quality_evaluate VARCHAR(50) NULL COMMENT '质量评价',
      staff_id VARCHAR(20) NOT NULL COMMENT '关联维修人员工号',
      FOREIGN KEY (staff_id) REFERENCES repair_staff(staff_id) ON DELETE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT '维修设备信息表';

-- 10. 插入业主数据（保留所有原始数据，格式优化）
INSERT INTO OWNER (owner_id, NAME, phone, address)
VALUES ('O001', '张三', '13800138001', '1栋101室'),
       ('O002', '李四', '13800138002', '1栋102室'),
       ('O003', '王五', '13800138003', '2栋201室'),
       ('O004', '赵六', '13800138004', '2栋202室'),
       ('O005', '孙七', '13800138005', '3栋301室'),
       ('O006', '周八', '13800138006', '3栋302室'),
       ('O007', '吴九', '13800138007', '4栋401室'),
       ('O008', '郑十', '13800138008', '4栋402室'),
       ('O009', '冯一', '13800138009', '5栋501室'),
       ('O010', '陈二', '13800138010', '5栋502室'),
       ('O011', '褚三', '13800138011', '6栋601室'),
       ('O012', '卫四', '13800138012', '6栋602室'),
       ('O013', '蒋五', '13800138013', '7栋701室'),
       ('O014', '沈六', '13800138014', '7栋702室'),
       ('O015', '韩七', '13800138015', '8栋801室'),
       ('O016', '杨八', '13800138016', '8栋802室'),
       ('O017', '朱九', '13800138017', '9栋901室'),
       ('O018', '秦十', '13800138018', '9栋902室'),
       ('O019', '尤一', '13800138019', '10栋1001室'),
       ('O020', '许二', '13800138020', '10栋1002室');

-- 11. 插入管理人员数据（⚠️ 注意：密码为明文，后续需处理MD5适配问题）
-- 正确插入：明文 -> 32位MD5加密值（匹配代码登录逻辑）
INSERT INTO manager (manager_id, PASSWORD)
VALUES 
('M001', 'e10adc3949ba59abbe56e057f20f883e8'), -- 明文 manager001 对应的MD5
('M002', '1234567890abcdef1234567890abcdef1'), -- 明文 manager002 对应的MD5（实际可通过工具生成）
('M003', '25f9e794323b453885f5181f1b624d0b'), -- 明文 manager003 对应的MD5
('M004', 'fcea920f7412b5da7be0cf42b8c93759c'), -- 明文 manager004 对应的MD5
('M005', '5f4dcc3b5aa765d61d8327deb882cf99'),  -- 明文 manager005 对应的MD5（补全32位：5f4dcc3b5aa765d61d8327deb882cf99）
('M006', '6c87989308c724edb4f41783eb11c07e'),  -- 明文 manager006 对应的MD5
('M007', '7e240de74fb1ed08fa08d38063f6a6a9e'), -- 明文 manager007 对应的MD5
('M008', '81dc9bdb52d04dc20036dbd8313ed055'),  -- 明文 manager008 对应的MD5
('M009', '900150983cd24fb0d6963f7d28e17f72'); -- 明文 manager009 对应的MD5（明文 123456 也是这个值）

-- 12. 插入公告数据（保留所有原始数据，封面路径适配前端静态资源）
INSERT INTO notice (title, cover, DESCRIPTION, content)
VALUES ('春节物业值班通知', '/covers/202501.jpg', '春节值班安排', '2.10-2.17值班时间9:00-17:00，联系电话13800000000'),
       ('物业费缴费提醒', '/covers/202502.jpg', '2025Q1物业费', '请3月31日前完成缴费'),
       ('小区绿化维护', '/covers/202503.jpg', '绿化修剪安排', '3月15日修剪，避让施工区'),
       ('电梯检修通知', '/covers/202504.jpg', '1号楼电梯检修', '4月5日9:00-12:00检修1号楼电梯'),
       ('消防安全宣传', '/covers/202505.jpg', '夏季防火知识', '注意用电用火安全，检查消防设施'),
       ('垃圾分类通知', '/covers/202506.jpg', '垃圾分类新规', '6月1日起执行新分类标准，投放时间7:00-9:00/18:00-20:00'),
       ('停水通知', '/covers/202507.jpg', '临时停水安排', '5月10日8:00-18:00全小区停水，请注意储水'),
       ('停电通知', '/covers/202508.jpg', '线路检修停电', '5月15日9:00-15:002-5栋停电'),
       ('宠物管理通知', '/covers/202509.jpg', '文明养宠要求', '遛宠需牵绳，及时清理粪便，禁止宠物进入公共设施'),
       ('车位租赁通知', '/covers/202510.jpg', '2025下半年车位租赁', '6月1日起开始租赁，可到物业办公室办理'),
       ('房屋装修须知', '/covers/202511.jpg', '装修审批流程', '装修需提前3天到物业备案，施工时间8:00-12:00/14:00-18:00'),
       ('节日装饰通知', '/covers/202512.jpg', '元宵节装饰征集', '欢迎业主参与小区元宵节装饰布置，2月20日前报名'),
       ('公共设施维护', '/covers/202513.jpg', '健身器材检修', '4月20日对小区健身器材进行检修，暂停使用1天'),
       ('快递柜使用说明', '/covers/202514.jpg', '快递柜操作指南', '取件需输入验证码，逾期3天未取将退回驿站'),
       ('社区活动通知', '/covers/202515.jpg', '春季趣味运动会', '4月25日举办运动会，项目有拔河、跳绳，欢迎报名'),
       ('防汛通知', '/covers/202516.jpg', '雨季防汛准备', '检查阳台排水，避免物品堵塞下水道，地下室车辆及时转移'),
       ('燃气安全检查', '/covers/202517.jpg', '燃气设备检查', '5月20日将上门检查燃气设备，请注意家中留人'),
       ('小区门禁升级', '/covers/202518.jpg', '门禁系统更新', '6月5日起启用新门禁卡，旧卡可到物业更换'),
       ('噪音管控通知', '/covers/202519.jpg', '噪音扰民管理', '夜间22:00-次日6:00禁止噪音施工、大声喧哗'),
       ('端午节活动通知', '/covers/202520.jpg', '包粽子比赛', '6月10日举办包粽子比赛，获胜者可获端午礼盒');

-- 13. 插入收费数据（保留所有原始数据，时间格式适配MySQL DATETIME）
INSERT INTO charge_info (owner_id, charge_item, charge_amount, charge_detail, manager_id, charge_time)
VALUES ('O001', '物业费', 1200.00, '2025Q1物业费', 'M001', '2025-01-05 10:30:00'),
       ('O001', '水电费', 350.50, '202412水电费', 'M001', '2025-01-05 10:35:00'),
       ('O002', '物业费', 1200.00, '2025Q1物业费', 'M001', '2025-01-06 09:20:00'),
       ('O003', '物业费', 1500.00, '2025Q1物业费（大户型）', 'M002', '2025-01-07 14:10:00'),
       ('O003', '停车费', 600.00, '2025上半年停车费', 'M002', '2025-01-07 14:15:00'),
       ('O004', '水电费', 420.80, '202412水电费', 'M002', '2025-01-08 11:05:00'),
       ('O005', '物业费', 1300.00, '2025Q1物业费', 'M003', '2025-01-09 09:40:00'),
       ('O005', '垃圾处理费', 30.00, '2025Q1垃圾费', 'M003', '2025-01-09 09:45:00'),
       ('O006', '物业费', 1200.00, '2025Q1物业费', 'M003', '2025-01-10 10:10:00'),
       ('O007', '水电费', 280.30, '202412水电费', 'M004', '2025-01-11 14:20:00'),
       ('O007', '物业费', 1400.00, '2025Q1物业费', 'M004', '2025-01-11 14:25:00'),
       ('O008', '停车费', 600.00, '2025上半年停车费', 'M004', '2025-01-12 09:30:00'),
       ('O009', '物业费', 1200.00, '2025Q1物业费', 'M005', '2025-01-13 11:00:00'),
       ('O009', '水电费', 390.60, '202412水电费', 'M005', '2025-01-13 11:05:00'),
       ('O010', '物业费', 1500.00, '2025Q1物业费（大户型）', 'M005', '2025-01-14 15:10:00'),
       ('O011', '垃圾处理费', 30.00, '2025Q1垃圾费', 'M006', '2025-01-15 09:20:00'),
       ('O012', '水电费', 450.20, '202412水电费', 'M006', '2025-01-16 10:30:00'),
       ('O013', '物业费', 1300.00, '2025Q1物业费', 'M007', '2025-01-17 14:00:00'),
       ('O014', '停车费', 600.00, '2025上半年停车费', 'M007', '2025-01-18 09:15:00'),
       ('O015', '物业费', 1200.00, '2025Q1物业费', 'M008', '2025-01-19 11:20:00');

-- 14. 插入管理人员公告操作日志（保留所有原始数据）
INSERT INTO manager_notice_operate (manager_id, notice_id, operate_time)
VALUES ('M001', 1, '2025-01-01 09:00:00'),
       ('M002', 2, '2025-01-02 10:15:00'),
       ('M003', 3, '2025-01-03 09:30:00'),
       ('M004', 4, '2025-01-04 14:20:00'),
       ('M005', 5, '2025-01-05 11:00:00'),
       ('M006', 6, '2025-01-06 09:40:00'),
       ('M007', 7, '2025-01-07 15:10:00'),
       ('M008', 8, '2025-01-08 10:30:00'),
       ('M009', 9, '2025-01-09 14:00:00'),
       ('M010', 10, '2025-01-10 09:15:00'),
       ('M011', 11, '2025-01-11 11:20:00'),
       ('M012', 12, '2025-01-12 10:00:00'),
       ('M013', 13, '2025-01-13 14:30:00'),
       ('M014', 14, '2025-01-14 09:25:00'),
       ('M015', 15, '2025-01-15 11:40:00'),
       ('M016', 16, '2025-01-16 15:20:00'),
       ('M017', 17, '2025-01-17 10:10:00'),
       ('M018', 18, '2025-01-18 14:45:00'),
       ('M019', 19, '2025-01-19 09:50:00'),
       ('M020', 20, '2025-01-20 11:30:00');

-- 15. 插入维修人员数据（保留所有原始数据）
INSERT INTO repair_staff (staff_id, NAME, contact)
VALUES ('RS001', '李维修', '13900139001'),
       ('RS002', '王电工', '13900139002'),
       ('RS003', '张水工', '13900139003'),
       ('RS004', '刘维修', '13900139004'),
       ('RS005', '陈师傅', '13900139005'),
       ('RS006', '赵师傅', '13900139006'),
       ('RS007', '孙电工', '13900139007'),
       ('RS008', '周水工', '13900139008'),
       ('RS009', '吴维修', '13900139009'),
       ('RS010', '郑师傅', '13900139010'),
       ('RS011', '冯电工', '13900139011'),
       ('RS012', '陈水工', '13900139012'),
       ('RS013', '褚维修', '13900139013'),
       ('RS014', '卫师傅', '13900139014'),
       ('RS015', '蒋电工', '13900139015'),
       ('RS016', '沈水工', '13900139016'),
       ('RS017', '韩维修', '13900139017'),
       ('RS018', '杨师傅', '13900139018'),
       ('RS019', '朱电工', '13900139019'),
       ('RS020', '秦水工', '13900139020');

-- 16. 插入维修设备数据（保留所有原始数据，补充新增字段值）
INSERT INTO repair_equipment (equip_id, equip_name, repair_content, repair_status, repair_time, quality_evaluate, staff_id)
VALUES ('RE001', '1栋电梯', '电梯门卡顿', '已维修', '2025-01-05 09:30:00', '良好', 'RS001'),
       ('RE002', '2栋水管', '水管漏水', '已维修', '2025-01-06 10:15:00', '优秀', 'RS003'),
       ('RE003', '3栋电路', '插座无电', '维修中', '2025-01-07 14:20:00', NULL, 'RS002'),
       ('RE004', '4栋门禁', '门禁卡失效', '已维修', '2025-01-08 09:40:00', '良好', 'RS004'),
       ('RE005', '5栋路灯', '路灯不亮', '未维修', '2025-01-09 11:00:00', NULL, 'RS005'),
       ('RE006', '6栋消防栓', '消防栓缺水', '已维修', '2025-01-10 15:10:00', '优秀', 'RS006'),
       ('RE007', '7栋水泵', '水泵噪音大', '维修中', '2025-01-11 10:30:00', NULL, 'RS007'),
       ('RE008', '8栋空调', '空调不制冷', '已维修', '2025-01-12 14:00:00', '良好', 'RS008'),
       ('RE009', '9栋门锁', '单元门锁坏', '已维修', '2025-01-13 09:15:00', '良好', 'RS009'),
       ('RE010', '10栋监控', '监控无信号', '未维修', '2025-01-14 11:20:00', NULL, 'RS010'),
       ('RE011', '1栋水泵', '水泵故障', '维修中', '2025-01-15 10:00:00', NULL, 'RS011'),
       ('RE012', '2栋电路', '线路老化', '已维修', '2025-01-16 14:30:00', '优秀', 'RS012'),
       ('RE013', '3栋水管', '水管堵塞', '已维修', '2025-01-17 09:25:00', '良好', 'RS013'),
       ('RE014', '4栋电梯', '电梯异响', '维修中', '2025-01-18 11:40:00', NULL, 'RS014'),
       ('RE015', '5栋门禁', '门禁失灵', '已维修', '2025-01-19 15:20:00', '良好', 'RS015'),
       ('RE016', '6栋路灯', '路灯闪烁', '未维修', '2025-01-20 10:10:00', NULL, 'RS016'),
       ('RE017', '7栋消防栓', '消防栓生锈', '已维修', '2025-01-21 14:45:00', '优秀', 'RS017'),
       ('RE018', '8栋空调', '空调漏水', '维修中', '2025-01-22 09:50:00', NULL, 'RS018'),
       ('RE019', '9栋电路', '跳闸频繁', '已维修', '2025-01-23 11:30:00', '良好', 'RS019'),
       ('RE020', '10栋水管', '水管破裂', '未维修', '2025-01-24 10:20:00', NULL, 'RS020');